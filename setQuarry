quarryFrameHeight = 4
quarryFrameWidth = 15
quarryFrameDepth = 15
fuelSlot = 16
Row = 0
Col = 0
Layer = 0

function findFuel()
	for i = 1, 16 do
		turtle.select(i)
		if turtle.refuel(0) then
			return i
		end
	end
	return 0
end

function checkFuel()
	if turtle.getFuelLevel() < 1 then
		fillFuel()
	end
end

function fillFuel()
	turtle.select(fuelSlot)

	if not turtle.refuel(0) then
		print("Looking for fuel")
		fuelSlot = findFuel()
	end

	if fuelSlot ~= 0 then
		turtle.select(fuelSlot)
		turtle.refuel(1)
		print("Fueling Up")
	else
		print("No Fuel Found")
	end
end

function checkInventory()
	local usedSlots = 0
	for i=1, 15 do
		if turtle.getItemCount(i) > 0 then
			usedSlots = usedSlots + 1
		end
	end

	if usedSlots == 15 then
		--- return to empty invetory
		print("Inventory Full")
	end
end

function driveFoward()
	checkInventory()
	checkFuel()
	if turtle.detect() then
		turtle.dig()
	end
	turtle.forward()
end

function driveUp()
	checkInventory()
	checkFuel()
	if turtle.detectUp() then
		turtle.digUp()
	end
	turtle.up()
end

function moveForward(spaces)
        local moves = 0
        for i=1, spaces do
            driveFoward()
            moves = i
        end
        return moves
end

function moveRight()
	turtle.turnRight()
	driveFoward()
	turtle.turnRight()
end

function moveLeft()
	turtle.turnLeft()
	driveFoward()
	turtle.turnLeft()
end

function moveUp()
	turtle.turnRight()
	driveUp()
end



---
--- Main Function
---
while Layer < quarryFrameHeight do
	while Col <= quarryFrameWidth do
		print("Clearing Column", Col)
		moveForward(quarryFrameDepth)

		if Col ~= quarryFrameWidth then
			if Col%2 == 0 then
				moveRight()
			else
				moveLeft()
			end
		end

		Row = 0
		Col = Col + 1
	end

	moveUp()
	Layer = Layer + 1
	Col = 0
	Row = 0
end
